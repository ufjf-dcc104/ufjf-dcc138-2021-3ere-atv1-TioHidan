<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCC138 exemplo 01</title>
</head>
<body>
    <h1>DCC138 exemplo 01</h1>
    <canvas></canvas>
    <p>Por Victor Torres</p>
    <script>
        let canvas = document.querySelector("canvas");
        
        let ctx = canvas.getContext("2d");
        
         canvas.width = 480;
         canvas.height = 320;
         let p={
          x: 150,
          vx :0,
          ax : 0,
          y : 100,
          vy : 0,
          ay : 0

         };
         
        let e= {
             ex : 300,
          evx : 0,
          eax : 0,
          ey  : 200,
          evy : 0,
          eay : 0

        };
        
        //refatora para extrair constante de velocidade
         const V = 180;
         let t0;
         let dt; 
         requestAnimationFrame(desenha);
         
         function desenha(t){

        if(t0===undefined) t0 = t;
        dt = (t - t0)/1000;
        //desenha fundo
         
        ctx.fillStyle = "black";
         ctx.fillRect(0,0,  canvas.width,canvas.height);
          
         //controladores
         e.eay= 0.5*(p.y - e.ey) - 0.2*e.evx;
         e.eax= 0.5*(p.x - e.ex) - 0.2*e.evy;
        
        //Atualiza Dinamica dos estados
        p.vx= p.vx + p.ax*dt;
        p.x = p.x + p.vx*dt;
        p.vy= p.vy + p.ay*dt;
        p.y = p.y + p.vy*dt;

        e.evx= e.evx + e.eax*dt;
        e.ex = e.ex + e.evx*dt;
        e.evy= e.evy + e.eay*dt;
        e.ey = e.ey + e.evy*dt;
         //desenha elementos
         
         ctx.fillStyle = "Red";
         ctx.fillRect(p.x,p.y,  20,20);

         ctx.fillStyle = "White";
         ctx.fillRect(e.ex,e.ey,  20,20);
         
         //chama a função desenha infinitas vezes
         requestAnimationFrame(desenha);
         t0 = t;
         }
          // evento pra quando vc quer que o boneco se mova infinito
         addEventListener("keydown" , teclapressionada);
         // evento para quando voce soltar o dedo do botao o personagem parar
         addEventListener("keyup" , teclasolta);


         function teclapressionada(e){
          //adiciona controle de velocidades
           switch (e.key){
               
                  case "ArrowUp":
                   p.ay=-V;
                   break;
                
                   case "ArrowDown":
                   p.ay= +V;
                   break;

                   case "ArrowRight":
                   p.ax=+V;
                   break;
                
                   case "ArrowLeft":
                   p.ax= -V;
                   break;

                 

           }

           
         }
         function teclasolta(e) {
          //adiciona controle de velocidades sem manter pressionado
           switch (e.key){
               
                  case "ArrowUp":
                   p.vy=0;
                   p.ay=0;
                   break;
                
                   case "ArrowDown":
                   p.vy= 0;
                   p.ay= 0;
                   break;

                   case "ArrowRight":
                   p.vx=0;
                   p.ax=0;
                   break;
                
                   case "ArrowLeft":
                   p.vx= 0;
                   p.ax=0;
                   break;

                   

           }
        }

        

    </script>
    
</body>
</html>