<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCC138 exemplo 01</title>
</head>
<body>
    <h1>DCC138 exemplo 01</h1>
    <canvas></canvas>
    <p>Por Victor Torres</p>
    <script>
        let canvas = document.querySelector("canvas");
        
        let ctx = canvas.getContext("2d");
        
         canvas.width = 480;
         canvas.height = 320;
         let p={
          x: 150,
          vx :0,
          ax : 0,
          y : 100,
          vy : 0,
          ay : 0,
          cor:"Red",
           desenhar: desenharElemento,
        
            mover: moverElemento

       
          };
         
        let e= {
          x : 300,
          vx : 0,
          ax : 0,
          y  : 200,
          vy : 0,
          ay : 0,
          cor: "White",
          desenhar: desenharElemento,
          mover: moverElemento,
         controlar: perseguirAlvo
          };
        
        //refatora para extrair constante de velocidade
         const V = 180;
         let t0;
         let dt; 
         requestAnimationFrame(desenha);
         
         function desenha(t){

        if(t0===undefined) t0 = t;
        dt = (t - t0)/1000;
        
        //desenha fundo
         
        ctx.fillStyle = "black";
         ctx.fillRect(0,0,  canvas.width,canvas.height);
          
         //controladores
         e.controlar(p);
         
        
        //Atualiza Dinamica dos estados
           p.mover();
           e.mover();
       
         //desenha elementos
           p.desenhar();
         
           e.desenhar();
         
         
         //chama a função desenha infinitas vezes
         requestAnimationFrame(desenha);
         t0 = t;
         }
        
        
         function moverElemento(){
        this.vx= this.vx + this.ax*dt;
        this.x = this.x + this.vx*dt;
        this.vy= this.vy + this.ay*dt;
        this.y = this.y + this.vy*dt;
         }
         
         // desenhar elemento
         function desenharElemento(){
           
           ctx.fillStyle = this.cor;
           ctx.fillRect(this.x,this.y,  20,20);
         }

         function perseguirAlvo(alvo){
            
            this.ay= 0.5*(alvo.y - this.y) - 0.2*this.vx;
            this.ax= 0.5*(alvo.x - this.x) - 0.2*this.vy;
         }

         function evitarAlvo(alvo){
            
            this.ay= -0.5*(alvo.y - this.y) - 0.2*this.vx;
            this.ax= -0.5*(alvo.x - this.x) - 0.2*this.vy;
         }
        
       
       
         // evento pra quando vc quer que o boneco se mova infinito
         addEventListener("keydown" , teclapressionada);
         
         
         
         // evento para quando voce soltar o dedo do botao o personagem parar
         addEventListener("keyup" , teclasolta);


        
        
        //adiciona controle de velocidades
         function teclapressionada(e){
          
           switch (e.key){
               
                  case "ArrowUp":
                   p.ay=-V;
                   break;
                
                   case "ArrowDown":
                   p.ay= +V;
                   break;

                   case "ArrowRight":
                   p.ax=+V;
                   break;
                
                   case "ArrowLeft":
                   p.ax= -V;
                   break;

                 

           }

           
         }
         //adiciona controle de velocidades sem manter pressionado
         function teclasolta(e) {
          
           switch (e.key){
               
                  case "ArrowUp":
                   
                   p.ay=0;
                   break;
                
                   case "ArrowDown":
                   
                   p.ay= 0;
                   break;

                   case "ArrowRight":
                   
                   p.ax=0;
                   break;
                
                   case "ArrowLeft":
                   
                   p.ax=0;
                   break;

                   

           }
        }

        

    </script>
    
</body>
</html>